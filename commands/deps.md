---
description: Check dependencies - outdated packages, security vulnerabilities, bundle size
allowed-tools: Bash, Read, Glob, WebSearch
model: opus
---

# Check Dependencies

Analyse project dependencies for updates, security issues, and optimisation opportunities.

## Phase 1: Gather Dependency Info

```bash
# List all outdated packages
npm outdated --json 2>/dev/null || npm outdated

# Check for security vulnerabilities
npm audit --json 2>/dev/null || npm audit

# Get package count
cat package.json | grep -E "dependencies|devDependencies" -A 100 | grep "\":" | wc -l
```

## Phase 2: Security Audit

### Critical Vulnerabilities

```bash
# Get high/critical vulnerabilities
npm audit --audit-level=high
```

If vulnerabilities found:
1. Check if update is available: `npm audit fix`
2. If breaking changes: `npm audit fix --force` (review changes!)
3. If no fix available: Consider alternative package

### Check for Known Issues

For each vulnerable package, search for:
- CVE details
- Whether it affects your usage
- Available patches or workarounds

## Phase 3: Outdated Analysis

### Categorise Updates

| Package | Current | Latest | Type | Risk |
|---------|---------|--------|------|------|
| react | 18.2.0 | 19.0.0 | Major | Medium |
| next | 14.1.0 | 15.0.0 | Major | Medium |
| tailwindcss | 3.4.0 | 3.4.1 | Patch | Low |

**Risk Levels:**
- **Patch** (x.x.X): Bug fixes, safe to update
- **Minor** (x.X.x): New features, usually safe
- **Major** (X.x.x): Breaking changes, needs review

### Safe Updates (Patch/Minor)

```bash
# Update all patch versions
npm update

# Update specific package to latest minor
npm install package@^X.0.0
```

### Major Updates (Careful!)

For each major update:
1. Read changelog
2. Check migration guide
3. Test in separate branch
4. Run full test suite

## Phase 4: Bundle Analysis

```bash
# Check if bundle analyser available
cat package.json | grep -E "analyze|bundle"

# Install if needed
npm install --save-dev @next/bundle-analyzer

# Run analysis (Next.js)
ANALYZE=true npm run build
```

### Large Dependencies to Review

Common heavy packages:
- `moment` â†’ Consider `date-fns` or `dayjs`
- `lodash` â†’ Use specific imports or native methods
- `axios` â†’ Consider native `fetch`
- `jquery` â†’ Remove if only used for one thing

```bash
# Check package sizes (requires package-size or similar)
npx package-size lodash moment axios date-fns
```

## Phase 5: Unused Dependencies

```bash
# Find potentially unused dependencies
npx depcheck

# Or manually check imports
for pkg in $(cat package.json | grep "\":" | grep -v "version\|name\|description" | cut -d'"' -f2); do
  count=$(grep -rn "from ['\"]$pkg" --include="*.ts" --include="*.tsx" . 2>/dev/null | grep -v node_modules | wc -l)
  if [ "$count" -eq "0" ]; then
    echo "Possibly unused: $pkg"
  fi
done
```

## Phase 6: Recommendations

### Priority Actions

```markdown
## ğŸ”’ Security (Do First)
| Package | Issue | Action |
|---------|-------|--------|
| [pkg] | [CVE] | `npm update [pkg]` |

## ğŸ“¦ Updates Available
### Safe to Update Now
```bash
npm update  # All patch updates
npm install [pkg]@latest  # Specific packages
```

### Major Updates (Plan These)
| Package | Current â†’ Latest | Breaking Changes |
|---------|------------------|------------------|
| next | 14 â†’ 15 | [Link to guide] |
| react | 18 â†’ 19 | [Link to guide] |

## ğŸ—‘ï¸ Consider Removing
| Package | Reason | Alternative |
|---------|--------|-------------|
| moment | Large bundle | date-fns |
| lodash | Only using 2 functions | Native JS |

## ğŸ“Š Bundle Impact
- Total dependencies: [N]
- Bundle size: [X] MB
- Largest packages: [list]
```

## Phase 7: Update Script

Generate a safe update script:

```bash
#!/bin/bash
# Safe dependency updates - generated by /deps

# Patch updates (safe)
npm update

# Minor updates (review changes)
npm install package1@^X.0.0 package2@^Y.0.0

# Run verification
npm run typecheck
npm run lint
npm run test
npm run build

echo "âœ… Updates complete - verify app manually"
```

## Output Summary

```markdown
## ğŸ“Š Dependency Report

### Overview
- **Total packages**: [N]
- **Outdated**: [N] packages
- **Security issues**: [N] vulnerabilities
- **Unused**: [N] packages

### Security Status
ğŸ”´ Critical: [N]
ğŸŸ  High: [N]
ğŸŸ¡ Moderate: [N]
ğŸ”µ Low: [N]

### Update Status
- Patch available: [N]
- Minor available: [N]
- Major available: [N]

### Recommended Actions
1. `npm audit fix` - Fix [N] vulnerabilities
2. `npm update` - Apply [N] safe updates
3. Review [package] major update
4. Remove unused: [packages]

### Commands to Run
```bash
# Fix security issues
npm audit fix

# Safe updates
npm update

# After major updates, verify:
npm run typecheck && npm run lint && npm run test && npm run build
```
```
